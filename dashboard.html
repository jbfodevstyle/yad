<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yad Dashboard</title>
    <script>
      const express = require('express');
const session = require('express-session');
const passport = require('passport');
const DiscordStrategy = require('passport-discord').Strategy;
const { Client } = require('discord.js');

const app = express();

app.set('view engine', 'ejs');
app.use(express.static(__dirname + '/public')); 

app.use(session({
    secret: 'your_secret_key',
    resave: false,
    saveUninitialized: false
}));

app.use(passport.initialize());
app.use(passport.session());

passport.serializeUser((user, done) => done(null, user));
passport.deserializeUser((obj, done) => done(null, obj));

passport.use(new DiscordStrategy({
    clientID: '1165399076297248778',
    clientSecret: 'b25c6e594518ed9be23f9aafeed97224b1180266938722e8a7a6ea8ddd14f1fa',
    callbackURL: 'https://discord.com/oauth2/authorize?client_id=1165399076297248778&redirect_uri=https%3A%2F%2Fjbfodevstyle.github.io%2Fyad%2Fdashboard&response_type=code&scope=identify%20guilds.join%20guilds',
    scope: ['identify', 'guilds']
}, (accessToken, refreshToken, profile, done) => {
    process.nextTick(() => done(null, profile));
}));

app.get('/', (req, res) => {
    res.render('index', { user: req.user });
});

app.get('/auth/discord', passport.authenticate('discord'));

app.get('/auth/discord/callback',
    passport.authenticate('discord', { failureRedirect: '/' }),
    (req, res) => {
        res.redirect('/dashboard');
    });

app.get('/dashboard', (req, res) => {
    if (!req.isAuthenticated()) {
        return res.redirect('/');
    }

    const client = new Client();
    client.login(req.user.accessToken);

    client.on('ready', async () => {
        const guilds = client.guilds.cache.map(guild => {
            return {
                id: guild.id,
                name: guild.name
            };
        });

        res.render('dashboard', { user: req.user, guilds });
    });
});

app.listen(3000, () => {
    console.log('Server is running on port 3000');
});
    </script>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="1362SDCVADRFCSAD67.css"> 
</head>

<body>
    <div class="container">
        <h1>Dashboard</h1>
        <h2>Hello, <%= user.username %>#<%= user.discriminator %></h2>
        <h3>Your Servers:</h3>
        <ul>
            <% guilds.forEach(guild => { %>
                <li><%= guild.name %></li>
            <% }); %>
        </ul>
        <a href="/logout">Logout</a>
    </div>
</body>

</html>

